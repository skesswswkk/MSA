"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3270],{73270:(e,a,r)=>{r.r(a),r.d(a,{AddToDashboard:()=>q});var s=r(68404),t=r(1696),n=r(64850),o=r(37744),d=r(82897),i=r(59052),l=r(36298),h=r(31181),c=r(80795),u=r(65737),b=r(78941),g=r(35258),f=r(65678),p=r(37625),v=r(2843),m=r(8006),x=r(71438),w=r(59196),D=r(89118),y=r(42200);let A;async function C(e){var a;const r=function(e,a){for(const{refId:r}of e.filter(j)){const e=S(r);if(a.flameGraphFrames.some(e))return"flamegraph";if(a.graphFrames.some(e))return"timeseries";if(a.logsFrames.some(e))return"logs";if(a.nodeGraphFrames.some(e))return"nodeGraph";if(a.traceFrames.some(e))return"traces"}return"table"}(e.queries,e.queryResponse),s={targets:e.queries,type:r,title:"New Panel",gridPos:{x:0,y:0,w:12,h:8},datasource:e.datasource};let t;if(e.dashboardUid)try{t=await y.ae.getDashboardByUid(e.dashboardUid)}catch(e){throw A.FETCH_DASHBOARD}else t=function(){const e=(0,D.ZQ)();return e.dashboard.panels=[],e}();t.dashboard.panels=[s,...null!==(a=t.dashboard.panels)&&void 0!==a?a:[]];try{(0,D.$M)(t)}catch{throw A.SET_DASHBOARD_LS}}!function(e){e.FETCH_DASHBOARD="fetch-dashboard",e.SET_DASHBOARD_LS="set-dashboard-ls-error"}(A||(A={}));const j=e=>!e.hide,S=e=>a=>a.refId===e;var O=r(45916);const T=["ref"],E=["ref","value","onChange"];function _(e,a){if(null==e)return{};var r,s,t={},n=Object.keys(e);for(s=0;s<n.length;s++)r=n[s],a.indexOf(r)>=0||(t[r]=e[r]);return t}var k,N;!function(e){e.NewDashboard="new-dashboard",e.ExistingDashboard="existing-dashboard"}(k||(k={})),function(e){e.UNKNOWN="unknown-error",e.NAVIGATION="navigation-error"}(N||(N={}));const U=e=>{let{onClose:a,exploreId:t}=e;const y=(0,n.v9)((0,o.F)(t)),[j,S]=(0,s.useState)(),{handleSubmit:U,control:q,formState:{errors:F},watch:I}=(0,i.cI)({defaultValues:{saveTarget:k.NewDashboard}}),R=w.Vt.hasAccess(n.bW.DashboardsCreate,w.Vt.isEditor),B=w.Vt.hasAccess(n.bW.DashboardsWrite,w.Vt.isEditor),H=[];R&&H.push({label:"New dashboard",value:k.NewDashboard}),B&&H.push({label:"Existing dashboard",value:k.ExistingDashboard});const V=H.length>1?I("saveTarget"):H[0].value,P=`Add panel to ${H.length>1?"dashboard":H[0].label.toLowerCase()}`,G=async(e,s)=>{S(void 0);const t=s.saveTarget===k.ExistingDashboard?s.dashboardUid:void 0;(0,h.ff)("e_2_d_submit",{newTab:e,saveTarget:s.saveTarget,queries:y.queries.length});try{var n;await C({dashboardUid:t,datasource:null===(n=y.datasourceInstance)||void 0===n?void 0:n.getRef(),queries:y.queries,queryResponse:y.queryResponse})}catch(e){switch(e){case A.FETCH_DASHBOARD:S({error:e,message:"Could not fetch dashboard information. Please try again."});break;case A.SET_DASHBOARD_LS:S({error:e,message:"Could not add panel to dashboard. Please try again."});break;default:S({error:N.UNKNOWN,message:"Something went wrong. Please try again."})}return}const o=function(e){return e?`d/${e}`:"dashboard/new"}(t);if(!e)return a(),void c.E1.push(l.u.stripBaseFromUrl(o));if(!!!r.g.open(u.v.appUrl+o,"_blank"))return S({error:N.NAVIGATION,message:"Could not navigate to the selected dashboard. Please try again."}),void(0,D.f1)();a()};return(0,s.useEffect)((()=>{(0,h.ff)("e_2_d_open")}),[]),(0,O.jsx)(b.u,{title:P,onDismiss:a,isOpen:!0,children:(0,O.jsxs)("form",{children:[H.length>1&&(0,O.jsx)(g.g,{control:q,render:e=>{let{}=e,a=_(e.field,T);return(0,O.jsx)(f.g,{label:"Target dashboard",description:"Choose where to add the panel.",children:(0,O.jsx)(p.S,Object.assign({options:H},a,{id:"e2d-save-target"}))})},name:"saveTarget"}),V===k.ExistingDashboard&&(0,O.jsx)(g.g,{render:e=>{var a;let{field:{onChange:r}}=e,s=_(e.field,E);return(0,O.jsx)(f.g,{label:"Dashboard",description:"Select in which dashboard the panel will be created.",error:null===(a=F.dashboardUid)||void 0===a?void 0:a.message,invalid:!!F.dashboardUid,children:(0,O.jsx)(x.o,Object.assign({},s,{inputId:"e2d-dashboard-picker",defaultOptions:!0,onChange:e=>r(null==e?void 0:e.uid)}))})},control:q,name:"dashboardUid",shouldUnregister:!0,rules:{required:{value:!0,message:"This field is required."}}}),j&&(0,O.jsx)(v.b,{severity:"error",title:"Error adding the panel",children:j.message}),(0,O.jsxs)(b.u.ButtonRow,{children:[(0,O.jsx)(m.zx,{type:"reset",onClick:a,fill:"outline",variant:"secondary",children:"Cancel"}),(0,O.jsx)(m.zx,{type:"submit",variant:"secondary",onClick:U((0,d.partial)(G,!0)),icon:"external-link-alt",children:"Open in new tab"}),(0,O.jsx)(m.zx,{type:"submit",variant:"primary",onClick:U((0,d.partial)(G,!1)),icon:"apps",children:"Open dashboard"})]})]})})},q=e=>{var a,r;let{exploreId:d}=e;const[i,l]=(0,s.useState)(!1),h=(0,o.F)(d),c=!(null===(a=(0,n.v9)(h))||void 0===a||null===(r=a.queries)||void 0===r||!r.length);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(t.h,{icon:"apps",onClick:()=>l(!0),"aria-label":"Add to dashboard",disabled:!c,children:"Add to dashboard"}),i&&(0,O.jsx)(U,{onClose:()=>l(!1),exploreId:d})]})}}}]);
//# sourceMappingURL=3270.6662d124aa77a8c47c87.js.map