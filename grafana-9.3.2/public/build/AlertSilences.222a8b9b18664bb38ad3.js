"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1783],{34509:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ot});var n,s=a(68404),r=a(70356),l=a(2843),i=a(72767),c=a(64850),o=a(23559),d=a(92431),u=a(39833),m=a(73615),g=a(62791),h=a(67921),x=a(52423),p=a(82897),v=a(59052),f=a(94255),j=a(13960),b=a(12717),y=a(88246),w=a(65737),A=a(16755),S=a(71980),C=a(65678),N=a(4645),$=a(93194),q=a(8006),k=a(19200),R=a(8157),M=a(34426),O=a(76938),E=a(64834),I=a(72710),D=a(42889),_=a(23691),z=a(5302),B=a(64313),T=a(36521),Q=a(80458),Y=a(90062),W=a(39440),Z=a(18304),V=a(45916);const G=()=>{var e;const[t,a]=(0,s.useState)([]),r=(0,v.Gc)(),l=(0,c.I0)(),{watch:i}=r,o=i("matchers"),d=(0,A.wW)(F),u=[{id:"state",label:"State",renderCell:function(e){let{data:{matchedInstance:t}}=e;return(0,V.jsx)(Z.l,{state:t.state})},size:"160px"},{id:"labels",label:"Labels",renderCell:function(e){let{data:{matchedInstance:t}}=e;return(0,V.jsx)(Y.s,{labels:t.labels})},size:"250px"},{id:"created",label:"Created",renderCell:function(e){let{data:{matchedInstance:t}}=e;return(0,V.jsx)(V.Fragment,{children:t.activeAt.startsWith("0001")?"-":(0,y.CQ)(t.activeAt).format("YYYY-MM-DD HH:mm:ss")})},size:"400px"}];(0,s.useEffect)((()=>{l((0,E.ei)())}),[l]);const m=(0,T.Zo)();return(0,f.Z)((()=>{const e=m.flatMap((e=>e.groups.flatMap((e=>e.rules.map((e=>e.promRule)).filter((e=>(0,Q.x_)(e))).flatMap((e=>{var t;return(0,D.TZ)(null!==(t=e.alerts)&&void 0!==t?t:[],o)}))))));a(e)}),500,[m,o]),(0,V.jsxs)("div",{children:[(0,V.jsxs)("h4",{className:d.title,children:["Affected alert instances",t.length>0?(0,V.jsx)(B.C,{className:d.badge,color:"blue",text:t.length}):null]}),(0,V.jsx)("div",{className:d.table,children:o.every((e=>!e.value&&!e.name))?n||(n=(0,V.jsx)("span",{children:"Add a valid matcher to see affected alerts"})):(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(W.t,{items:null!==(e=t.slice(0,5))&&void 0!==e?e:[],isExpandable:!1,cols:u}),t.length>5&&(0,V.jsxs)("div",{className:d.moreMatches,children:["and ",t.length-5," more"]})]})})]})};const F=e=>({table:x.css`
    max-width: ${e.breakpoints.values.lg}px;
  `,moreMatches:x.css`
    margin-top: ${e.spacing(1)};
  `,title:x.css`
    display: flex;
    align-items: center;
  `,badge:x.css`
    margin-left: ${e.spacing(1)};
  `});var H=a(35258),P=a(70917),K=a(23734);const L=["onChange","ref"];const J=e=>({wrapper:x.css`
      margin-top: ${e.spacing(2)};
    `,row:x.css`
      display: flex;
      align-items: flex-start;
      flex-direction: row;
      background-color: ${e.colors.background.secondary};
      padding: ${e.spacing(1)} ${e.spacing(1)} 0 ${e.spacing(1)};
      & > * + * {
        margin-left: ${e.spacing(2)};
      }
    `,removeButton:x.css`
      margin-left: ${e.spacing(1)};
      margin-top: ${e.spacing(2.5)};
    `,matcherOptions:x.css`
      min-width: 140px;
    `,matchers:x.css`
      max-width: ${e.breakpoints.values.sm}px;
      margin: ${e.spacing(1)} 0;
      padding-top: ${e.spacing(.5)};
    `}),U=e=>{let{className:t}=e;const a=(0,A.wW)(J),n=(0,v.Gc)(),{control:s,register:r,formState:{errors:l}}=n,{fields:i=[],append:c,remove:o}=(0,v.Dq)({name:"matchers"});return(0,V.jsx)("div",{className:(0,x.cx)(t,a.wrapper),children:(0,V.jsx)(C.g,{label:"Matching labels",required:!0,children:(0,V.jsxs)("div",{children:[(0,V.jsx)("div",{className:a.matchers,children:i.map(((e,t)=>{var n,c,d,u,m,g,h,x,p,v;return(0,V.jsxs)("div",{className:a.row,"data-testid":"matcher",children:[(0,V.jsx)(C.g,{label:"Label",invalid:!(null==l||null===(n=l.matchers)||void 0===n||null===(c=n[t])||void 0===c||!c.name),error:null==l||null===(d=l.matchers)||void 0===d||null===(u=d[t])||void 0===u||null===(m=u.name)||void 0===m?void 0:m.message,children:(0,V.jsx)(N.I,Object.assign({},r(`matchers.${t}.name`,{required:{value:!0,message:"Required."}}),{defaultValue:e.name,placeholder:"label"}))}),(0,V.jsx)(C.g,{label:"Operator",children:(0,V.jsx)(H.g,{control:s,render:e=>{let{field:{onChange:t}}=e,n=function(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e.field,L);return(0,V.jsx)(P.Ph,Object.assign({},n,{onChange:e=>t(e.value),className:a.matcherOptions,options:I.tA,"aria-label":"operator"}))},defaultValue:e.operator||I.tA[0].value,name:`matchers.${t}.operator`,rules:{required:{value:!0,message:"Required."}}})}),(0,V.jsx)(C.g,{label:"Value",invalid:!(null==l||null===(g=l.matchers)||void 0===g||null===(h=g[t])||void 0===h||!h.value),error:null==l||null===(x=l.matchers)||void 0===x||null===(p=x[t])||void 0===p||null===(v=p.value)||void 0===v?void 0:v.message,children:(0,V.jsx)(N.I,Object.assign({},r(`matchers.${t}.value`,{required:{value:!0,message:"Required."}}),{defaultValue:e.value,placeholder:"value"}))}),i.length>1&&(0,V.jsx)(K.h,{className:a.removeButton,tooltip:"Remove matcher",name:"trash-alt",onClick:()=>o(t),children:"Remove"})]},`${e.id}`)}))}),(0,V.jsx)(q.zx,{type:"button",icon:"plus",variant:"secondary",onClick:()=>{const e={name:"",value:"",operator:R._M.equal};c(e)},children:"Add matcher"})]})})})};var X=a(38942);const ee=()=>{const{control:e,getValues:t}=(0,v.Gc)(),{field:{onChange:a,value:n},fieldState:{invalid:s}}=(0,v.bc)({name:"startsAt",control:e,rules:{validate:e=>t().endsAt>e}}),{field:{onChange:r,value:l},fieldState:{invalid:i}}=(0,v.bc)({name:"endsAt",control:e,rules:{validate:e=>t().startsAt<e}}),{field:{onChange:c,value:o}}=(0,v.bc)({name:"timeZone",control:e}),d=s||i,u=(0,y.CQ)(n),m=(0,y.CQ)(l);return(0,V.jsx)(C.g,{className:te.timeRange,label:"Silence start and end",error:d?"To is before or the same as from":"",invalid:d,children:(0,V.jsx)(X.K,{value:{from:u,to:m,raw:{from:u,to:m}},timeZone:o,onChange:e=>{a((0,y.CQ)(e.from)),r((0,y.CQ)(e.to))},onChangeTimeZone:e=>c(e),hideTimeZone:!1,hideQuickRanges:!0,placeholder:"Select time range"})})},te={timeRange:x.css`
    width: 400px;
  `};var ae,ne,se,re,le;const ie=(e,t)=>{const a=new Date;if(t){var n;const e=Date.parse(t.endsAt)<Date.now()?{start:a,end:(0,j.Ks)(a,{hours:2})}:{start:new Date(t.startsAt),end:new Date(t.endsAt)};return{id:t.id,startsAt:e.start.toISOString(),endsAt:e.end.toISOString(),comment:t.comment,createdBy:t.createdBy,duration:(0,j.vT)(e),isRegex:!1,matchers:(null===(n=t.matchers)||void 0===n?void 0:n.map(I.cm))||[],matcherName:"",matcherValue:"",timeZone:b.Ys}}{const t=(0,j.Ks)(a,{hours:2});return Object.assign({id:"",startsAt:a.toISOString(),endsAt:t.toISOString(),comment:`created ${(0,y.CQ)().format("YYYY-MM-DD HH:mm")}`,createdBy:w.v.bootData.user.name,duration:"2h",isRegex:!1,matchers:[{name:"",value:"",operator:R._M.equal}],matcherName:"",matcherValue:"",timeZone:b.Ys},(e=>{const t={},a=e.get("comment"),n=e.getAll("matcher"),s=(0,D.RT)(n);return s.length&&(t.matchers=s.map(I.cm)),a&&(t.comment=a),t})(e))}},ce=e=>({field:x.css`
    margin: ${e.spacing(1,0)};
  `,textArea:x.css`
    max-width: ${e.breakpoints.values.sm}px;
  `,createdBy:x.css`
    width: 200px;
  `,flexRow:x.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;

    & > * {
      margin-right: ${e.spacing(1)};
    }
  `,silencePeriod:x.css`
    max-width: ${e.breakpoints.values.sm}px;
  `}),oe=e=>{var t,a;let{silence:n,alertManagerSourceName:r}=e;const[l]=(0,M.j)(),i=(0,s.useMemo)((()=>ie(l,n)),[n,l]),o=(0,v.cI)({defaultValues:i}),d=(0,c.I0)(),u=(0,A.wW)(ce),{loading:m}=(0,O._)((e=>e.updateSilence));(0,k.x)((e=>e.unifiedAlerting.updateSilence=z.oq));const{register:g,handleSubmit:h,formState:b,watch:R,setValue:D,clearErrors:B}=o,T=R("duration"),Q=R("startsAt"),Y=R("endsAt"),[W,Z]=(0,s.useState)(T);(0,f.Z)((()=>{if((0,j.qb)(Q)&&(0,j.qb)(Y))if(T!==W)D("endsAt",(0,y.CQ)((0,j.Ks)(new Date(Q),(0,j.RA)(T))).toISOString()),Z(T);else{const e=new Date(Q).valueOf();if(new Date(Y).valueOf()>e){const e=(0,j.vT)({start:new Date(Q),end:new Date(Y)});D("duration",e),Z(e)}}}),700,[B,T,Y,W,D,Q]);const F=Boolean(w.v.bootData.user.isSignedIn&&w.v.bootData.user.name);return(0,V.jsx)(v.RV,Object.assign({},o,{children:(0,V.jsxs)("form",{onSubmit:h((e=>{const{id:t,startsAt:a,endsAt:n,comment:s,createdBy:l,matchers:i}=e,c=i.map(I._J),o=(0,p.pickBy)({id:t,startsAt:a,endsAt:n,comment:s,createdBy:l,matchers:c},(e=>!!e));d((0,E.QY)({alertManagerSourceName:r,payload:o,exitOnSave:!0,successMessage:"Silence "+(o.id?"updated":"created")}))})),children:[(0,V.jsxs)(S.C,{label:""+(n?"Recreate silence":"Create silence"),children:[(0,V.jsxs)("div",{className:(0,x.cx)(u.flexRow,u.silencePeriod),children:[ae||(ae=(0,V.jsx)(ee,{})),(0,V.jsx)(C.g,{label:"Duration",invalid:!!b.errors.duration,error:b.errors.duration&&("required"===b.errors.duration.type?"Required field":b.errors.duration.message),children:(0,V.jsx)(N.I,Object.assign({className:u.createdBy},g("duration",{validate:e=>0===Object.keys((0,j.RA)(e)).length?"Invalid duration. Valid example: 1d 4h (Available units: y, M, w, d, h, m, s)":void 0}),{id:"duration"}))})]}),ne||(ne=(0,V.jsx)(U,{})),(0,V.jsx)(C.g,{className:(0,x.cx)(u.field,u.textArea),label:"Comment",required:!0,error:null===(t=b.errors.comment)||void 0===t?void 0:t.message,invalid:!!b.errors.comment,children:(0,V.jsx)($.K,Object.assign({},g("comment",{required:{value:!0,message:"Required."}}),{rows:5,placeholder:"Details about the silence"}))}),!F&&(0,V.jsx)(C.g,{className:(0,x.cx)(u.field,u.createdBy),label:"Created By",required:!0,error:null===(a=b.errors.createdBy)||void 0===a?void 0:a.message,invalid:!!b.errors.createdBy,children:(0,V.jsx)(N.I,Object.assign({},g("createdBy",{required:{value:!0,message:"Required."}}),{placeholder:"Who's creating the silence"}))}),se||(se=(0,V.jsx)(G,{}))]}),(0,V.jsxs)("div",{className:u.flexRow,children:[m&&(re||(re=(0,V.jsx)(q.zx,{disabled:!0,icon:"fa fa-spinner",variant:"primary",children:"Saving..."}))),!m&&(le||(le=(0,V.jsx)(q.zx,{type:"submit",children:"Submit"}))),(0,V.jsx)(q.Qj,{href:(0,_.eQ)("alerting/silences",r),variant:"secondary",fill:"outline",children:"Cancel"})]})]})}))};var de=a(42914),ue=a(68522),me=a(32889),ge=a(99500),he=a(19512),xe=a(59196),pe=a(96535),ve=a(60277);const fe=["className"];const je=e=>{let{className:t}=e,a=function(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,fe);const n=(0,A.wW)(be);return(0,V.jsx)(q.zx,Object.assign({variant:"secondary",size:"xs",className:(0,x.cx)(n.wrapper,t)},a))},be=e=>({wrapper:x.css`
    height: 24px;
    font-size: ${e.typography.bodySmall.fontSize};
  `});var ye,we=a(83221),Ae=a(74562),Se=a(334),Ce=a(75442);const Ne=e=>{let{alertManagerSourceName:t}=e;const a=(0,pe.QX)(t);return xe.Vt.hasAccess(a.create,xe.Vt.isEditor)?(0,V.jsx)(Ce.Z,{title:"You haven't created any silences yet",buttonIcon:"bell-slash",buttonLink:(0,_.eQ)("alerting/silence/new",t),buttonTitle:"New silence"}):ye||(ye=(0,V.jsx)(Se._,{callToActionElement:(0,V.jsx)("div",{}),message:"No silences found."}))};var $e,qe=a(18033),ke=a(23542),Re=a(40711);const Me=e=>{let{alert:t,className:a}=e;const[n,r]=(0,s.useState)(!0),l=(0,j.vT)({start:new Date(t.startsAt),end:new Date(t.endsAt)}),i=Object.entries(t.labels).reduce(((e,t)=>{let[a,n]=t;return"alertname"!==a&&"__alert_rule_title__"!==a||(e=n),e}),"");return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("tr",{className:a,children:[(0,V.jsx)("td",{children:(0,V.jsx)(ke.U,{isCollapsed:n,onToggle:e=>r(e)})}),(0,V.jsx)("td",{children:(0,V.jsx)(Re.G,{state:t.status.state})}),(0,V.jsxs)("td",{children:["for ",l," seconds"]}),(0,V.jsx)("td",{children:i})]}),!n&&(0,V.jsxs)("tr",{className:a,children:[$e||($e=(0,V.jsx)("td",{})),(0,V.jsx)("td",{colSpan:5,children:(0,V.jsx)(Y.s,{labels:t.labels})})]})]})};var Oe,Ee;const Ie=e=>({tableMargin:x.css`
    margin-bottom: ${e.spacing(1)};
  `,colState:x.css`
    width: 110px;
  `,colName:x.css`
    width: 65%;
  `}),De=e=>{let{silencedAlerts:t}=e;const a=(0,A.wW)(qe.D),n=(0,A.wW)(Ie);return t.length?(0,V.jsxs)("table",{className:(0,x.cx)(a.table,n.tableMargin),children:[(0,V.jsxs)("colgroup",{children:[(0,V.jsx)("col",{className:a.colExpand}),(0,V.jsx)("col",{className:n.colState}),Oe||(Oe=(0,V.jsx)("col",{})),(0,V.jsx)("col",{className:n.colName})]}),Ee||(Ee=(0,V.jsx)("thead",{children:(0,V.jsxs)("tr",{children:[(0,V.jsx)("th",{}),(0,V.jsx)("th",{children:"State"}),(0,V.jsx)("th",{}),(0,V.jsx)("th",{children:"Alert name"})]})})),(0,V.jsx)("tbody",{children:t.map(((e,t)=>(0,V.jsx)(Me,{alert:e,className:t%2==0?a.evenRow:""},e.fingerprint)))})]}):null},_e=e=>{let{silence:t}=e;const{startsAt:a,endsAt:n,comment:s,createdBy:r,silencedAlerts:l}=t,i=(0,A.wW)(ze),c="YYYY-MM-DD HH:mm",o=de.parse(a),d=de.parse(n),u=(0,j.vT)({start:new Date(a),end:new Date(n)});return(0,V.jsxs)("div",{className:i.container,children:[(0,V.jsx)("div",{className:i.title,children:"Comment"}),(0,V.jsx)("div",{children:s}),(0,V.jsx)("div",{className:i.title,children:"Schedule"}),(0,V.jsx)("div",{children:`${null==o?void 0:o.format(c)} - ${null==d?void 0:d.format(c)}`}),(0,V.jsx)("div",{className:i.title,children:"Duration"}),(0,V.jsxs)("div",{children:[" ",u]}),(0,V.jsx)("div",{className:i.title,children:"Created by"}),(0,V.jsxs)("div",{children:[" ",r]}),(0,V.jsx)("div",{className:i.title,children:"Affected alerts"}),(0,V.jsx)(De,{silencedAlerts:l})]})},ze=e=>({container:x.css`
    display: grid;
    grid-template-columns: 1fr 9fr;
    grid-row-gap: 1rem;
  `,title:x.css`
    color: ${e.colors.text.primary};
  `,row:x.css`
    margin: ${e.spacing(1,0)};
  `});var Be=a(54743);const Te={[R.As.Active]:"good",[R.As.Expired]:"neutral",[R.As.Pending]:"neutral"},Qe=e=>{let{state:t}=e;return(0,V.jsx)(Be.i,{state:Te[t],children:t})};var Ye,We,Ze=a(83744),Ve=a(21888),Ge=a(37625);const Fe=Object.entries(R.As).map((e=>{let[t,a]=e;return{label:t,value:a}})),He=()=>(0,p.uniqueId)("query-string-"),Pe=()=>{const[e,t]=(0,s.useState)(He()),[a,n]=(0,he.K)(),{queryString:r,silenceState:l}=(0,_.pF)(a),i=(0,A.wW)(Ke),c=(0,p.debounce)((e=>{const t=e.target;n({queryString:t.value||null})}),400),o=!!(r&&r.length>3)&&0===(0,I.Zh)(r).length;return(0,V.jsxs)("div",{className:i.flexRow,children:[(0,V.jsx)(C.g,{className:i.rowChild,label:Ye||(Ye=(0,V.jsx)(Ze._,{children:(0,V.jsxs)(ue.Stack,{gap:.5,children:[(0,V.jsx)("span",{children:"Search by matchers"}),(0,V.jsx)(Ve.u,{content:(0,V.jsxs)("div",{children:["Filter silences by matchers using a comma separated list of matchers, ie:",(0,V.jsx)("pre",{children:"severity=critical, instance=~cluster-us-.+"})]}),children:(0,V.jsx)(ge.J,{name:"info-circle",size:"sm"})})]})})),invalid:o,error:o?"Query must use valid matcher syntax":null,children:(0,V.jsx)(N.I,{className:i.searchInput,prefix:We||(We=(0,V.jsx)(ge.J,{name:"search"})),onChange:c,defaultValue:null!=r?r:"",placeholder:"Search","data-testid":"search-query-input"},e)}),(0,V.jsx)(C.g,{className:i.rowChild,label:"State",children:(0,V.jsx)(Ge.S,{options:Fe,value:l,onChange:e=>{n({silenceState:e})}})}),(r||l)&&(0,V.jsx)("div",{className:i.rowChild,children:(0,V.jsx)(q.zx,{variant:"secondary",icon:"times",onClick:()=>{n({queryString:null,silenceState:null}),setTimeout((()=>t(He())))},children:"Clear filters"})})]})},Ke=e=>({searchInput:x.css`
    width: 360px;
  `,flexRow:x.css`
    display: flex;
    flex-direction: row;
    align-items: flex-end;
    padding-bottom: ${e.spacing(2)};
    border-bottom: 1px solid ${e.colors.border.strong};
  `,rowChild:x.css`
    margin-right: ${e.spacing(1)};
    margin-bottom: 0;
    max-height: 52px;
  `,fieldLabel:x.css`
    font-size: 12px;
    font-weight: 500;
  `});var Le,Je,Ue,Xe;const et=e=>{const[t]=(0,he.K)();return(0,s.useMemo)((()=>{const{queryString:a,silenceState:n}=(0,_.pF)(t),s=null==t?void 0:t.silenceIds;return e.filter((e=>{if("string"==typeof s){if(!s.split(",").includes(e.id))return!1}if(a){if(!(0,I.Zh)(a).every((t=>{var a;return null===(a=e.matchers)||void 0===a?void 0:a.some((e=>{let{name:a,value:n,isEqual:s,isRegex:r}=e;return t.name===a&&t.value===n&&t.isEqual===s&&t.isRegex===r}))})))return!1}if(n){if(!(e.status.state===n))return!1}return!0}))}),[t,e])},tt=e=>({topButtonContainer:x.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-end;
  `,addNewSilence:x.css`
    margin: ${e.spacing(2,0)};
  `,callout:x.css`
    background-color: ${e.colors.background.secondary};
    border-top: 3px solid ${e.colors.info.border};
    border-radius: 2px;
    height: 62px;
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-top: ${e.spacing(2)};

    & > * {
      margin-left: ${e.spacing(1)};
    }
  `,calloutIcon:x.css`
    color: ${e.colors.info.text};
  `,editButton:x.css`
    margin-left: ${e.spacing(.5)};
  `});const at=e=>{let{silences:t,alertManagerAlerts:a,alertManagerSourceName:n}=e;const r=(0,A.wW)(tt),[l]=(0,he.K)(),i=et(t),o=(0,pe.QX)(n),{silenceState:d}=(0,_.pF)(l),u=!!i.length&&(void 0===d||d===R.As.Expired),m=function(e){const t=(0,c.I0)(),a=(0,A.wW)(tt),n=(0,pe.QX)(e);return(0,s.useMemo)((()=>{const s=a=>{t((0,E.yO)(e,a))},r=[{id:"state",label:"State",renderCell:function(e){let{data:{status:t}}=e;return(0,V.jsx)(Qe,{state:t.state})},size:"88px"},{id:"matchers",label:"Matching labels",renderCell:function(e){let{data:{matchers:t}}=e;return(0,V.jsx)(Ae.g,{matchers:t||[]})},size:9},{id:"alerts",label:"Alerts",renderCell:function(e){let{data:{silencedAlerts:t}}=e;return(0,V.jsx)("span",{"data-testid":"alerts",children:t.length})},size:1},{id:"schedule",label:"Schedule",renderCell:function(e){let{data:{startsAt:t,endsAt:a}}=e;const n=de.parse(t),s=de.parse(a),r="YYYY-MM-DD HH:mm";return(0,V.jsxs)(V.Fragment,{children:[" ",null==n?void 0:n.format(r)," ","-",Ue||(Ue=(0,V.jsx)("br",{})),null==s?void 0:s.format(r)]})},size:"150px"}];return xe.Vt.hasAccess(n.update,xe.Vt.isEditor)&&r.push({id:"actions",label:"Actions",renderCell:function(t){let{data:n}=t;return(0,V.jsxs)(ue.Stack,{gap:.5,children:["expired"===n.status.state?(0,V.jsx)(me.r,{href:(0,_.eQ)(`/alerting/silence/${n.id}/edit`,e),children:Xe||(Xe=(0,V.jsx)(je,{icon:"sync",children:"Recreate"}))}):(0,V.jsx)(je,{icon:"bell",onClick:()=>s(n.id),children:"Unsilence"}),"expired"!==n.status.state&&(0,V.jsx)(we.A,{className:a.editButton,to:(0,_.eQ)(`/alerting/silence/${n.id}/edit`,e),icon:"pen",tooltip:"edit"})]})},size:"147px"}),r}),[e,t,a,n])}(n),g=(0,s.useMemo)((()=>i.map((e=>{const t=(n=e.id,a.filter((e=>e.status.silencedBy.includes(n))));var n;return{id:e.id,data:Object.assign({},e,{silencedAlerts:t})}}))),[i,a]);return(0,V.jsxs)("div",{"data-testid":"silences-table",children:[!!t.length&&(0,V.jsxs)(V.Fragment,{children:[Le||(Le=(0,V.jsx)(Pe,{})),(0,V.jsx)(ve.q,{actions:[o.create],fallback:xe.Vt.isEditor,children:(0,V.jsx)("div",{className:r.topButtonContainer,children:(0,V.jsx)(me.r,{href:(0,_.eQ)("/alerting/silence/new",n),children:(0,V.jsx)(q.zx,{className:r.addNewSilence,icon:"plus",children:"New Silence"})})})}),g.length?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(W.t,{items:g,cols:m,isExpandable:!0,renderExpandedContent:e=>{let{data:t}=e;return(0,V.jsx)(_e,{silence:t})}}),u&&(0,V.jsxs)("div",{className:r.callout,children:[(0,V.jsx)(ge.J,{className:r.calloutIcon,name:"info-circle"}),Je||(Je=(0,V.jsx)("span",{children:"Expired silences are automatically deleted after 5 days."}))]})]}):"No matching silences found"]}),!t.length&&(0,V.jsx)(Ne,{alertManagerSourceName:n})]})};var nt=a(69066),st=a(46150);const rt={icon:"bell-slash",breadcrumbs:[{title:"Silences",url:"alerting/silences"}]};var lt,it,ct=a(74846);const ot=(0,i.Pf)((()=>{var e,t,a;const n=(0,st.k)("instance"),[i,x]=(0,nt.k)(n),p=(0,c.I0)(),{useGetAlertmanagerChoiceQuery:v}=o.h,f=(0,O._)((e=>e.silences)),j=(0,O._)((e=>e.amAlerts)),b=i?j[i]||z.oq:void 0,y=(0,r.TH)(),w=function(){const{isExact:e,path:t}=(0,r.$B)(),[a,n]=(0,s.useState)();return(0,s.useEffect)((()=>{"/alerting/silence/new"===t?n(Object.assign({},rt,{id:"silence-new",text:"Add silence"})):"/alerting/silence/:id/edit"===t&&n(Object.assign({},rt,{id:"silence-edit",text:"Edit silence"}))}),[t,e]),a}(),A=y.pathname.endsWith("/alerting/silences"),{currentData:S}=d.T.useDiscoverAmFeaturesQuery({amSourceName:null!=i?i:""},{skip:!i}),{currentData:C}=v();(0,s.useEffect)((()=>{function e(){i&&(p((0,E.je)(i)),p((0,E.dB)(i)))}e();const t=setInterval((()=>e),ct.cm);return()=>{clearInterval(t)}}),[i,p]);const{result:N,loading:$,error:q}=i&&f[i]||z.oq,k=(0,s.useCallback)((e=>N&&N.find((t=>t.id===e))),[N]),R=(null==q||null===(e=q.message)||void 0===e?void 0:e.includes("the Alertmanager is not configured"))&&(null==S?void 0:S.lazyConfigInit);return i?(0,V.jsxs)(m.J,{pageId:"silences",isLoading:$,pageNav:w,children:[(0,V.jsx)(u.P,{disabled:!A,current:i,onChange:x,dataSources:n}),(0,V.jsx)(g.u,{currentAlertmanager:i,alertmanagerChoice:C}),R&&(it||(it=(0,V.jsx)(l.b,{title:"The selected Alertmanager has no configuration",severity:"warning",children:"Create a new contact point to create a configuration using the default values or contact your administrator to set up the Alertmanager."}))),q&&!$&&!R&&(0,V.jsx)(l.b,{severity:"error",title:"Error loading silences",children:q.message||"Unknown error."}),(null==b?void 0:b.error)&&!(null!=b&&b.loading)&&!R&&(0,V.jsx)(l.b,{severity:"error",title:"Error loading Alertmanager alerts",children:(null===(t=b.error)||void 0===t?void 0:t.message)||"Unknown error."}),N&&!q&&(0,V.jsxs)(r.rs,{children:[(0,V.jsx)(r.AW,{exact:!0,path:"/alerting/silences",children:(0,V.jsx)(at,{silences:N,alertManagerAlerts:null!==(a=null==b?void 0:b.result)&&void 0!==a?a:[],alertManagerSourceName:i})}),(0,V.jsx)(r.AW,{exact:!0,path:"/alerting/silence/new",children:(0,V.jsx)(oe,{alertManagerSourceName:i})}),(0,V.jsx)(r.AW,{exact:!0,path:"/alerting/silence/:id/edit",children:e=>{let{match:t}=e;return(null==t?void 0:t.params.id)&&(0,V.jsx)(oe,{silence:k(t.params.id),alertManagerSourceName:i})}})]})]}):A?(0,V.jsx)(m.J,{pageId:"silences",pageNav:w,children:(0,V.jsx)(h.I,{availableAlertManagers:n})}):lt||(lt=(0,V.jsx)(r.l_,{to:"/alerting/silences"}))}),{style:"page"})},23559:(e,t,a)=>{a.d(t,{h:()=>n});const n=a(47175).C.injectEndpoints({endpoints:e=>({getAlertmanagerChoice:e.query({query:()=>({url:"/api/v1/ngalert"}),providesTags:["AlertmanagerChoice"],transformResponse:e=>e.alertmanagersChoice}),getExternalAlertmanagerConfig:e.query({query:()=>({url:"/api/v1/ngalert/admin_config"}),providesTags:["AlertmanagerChoice"]}),getExternalAlertmanagers:e.query({query:()=>({url:"/api/v1/ngalert/alertmanagers"}),transformResponse:e=>e.data}),saveExternalAlertmanagersConfig:e.mutation({query:e=>({url:"/api/v1/ngalert/admin_config",method:"POST",data:e}),invalidatesTags:["AlertmanagerChoice"]})})})},73615:(e,t,a)=>{a.d(t,{J:()=>r});a(68404);var n=a(37417),s=a(45916);const r=e=>{let{children:t,pageId:a,pageNav:r,isLoading:l}=e;return(0,s.jsx)(n.T,{pageNav:r,navId:a,children:(0,s.jsx)(n.T.Contents,{isLoading:l,children:t})})}},60277:(e,t,a)=>{a.d(t,{q:()=>r});a(68404);var n=a(59196),s=a(45916);const r=e=>{let{actions:t,children:a,fallback:r=!0}=e;return t.some((e=>n.Vt.hasAccess(e,r)))?(0,s.jsx)(s.Fragment,{children:a}):null}},62791:(e,t,a)=>{a.d(t,{u:()=>o});var n=a(52423),s=(a(68404),a(16755)),r=a(2843),l=a(8157),i=a(43271),c=a(45916);function o(e){let{alertmanagerChoice:t,currentAlertmanager:a}=e;const n=(0,s.wW)(d);return a!==i.GC||t!==l.TE.External?null:(0,c.jsxs)(r.b,{title:"Grafana alerts are not delivered to Grafana Alertmanager",children:["Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts!",(0,c.jsx)("div",{className:n.adminHint,children:"You can change the configuration on the Alerting Admin page. If you do not have access, contact your Administrator"})]})}const d=e=>({adminHint:n.css`
    font-size: ${e.typography.bodySmall.fontSize};
    font-weight: ${e.typography.bodySmall.fontWeight};
  `})},67921:(e,t,a)=>{a.d(t,{I:()=>g});a(68404);var n,s,r,l,i=a(2843),c=a(69066),o=a(39833),d=a(45916);const u=()=>n||(n=(0,d.jsx)(i.b,{title:"No Alertmanager found",severity:"warning",children:"We could not find any external Alertmanagers and you may not have access to the built-in Grafana Alertmanager."})),m=()=>s||(s=(0,d.jsx)(i.b,{title:"Selected Alertmanager not found. Select a different Alertmanager.",severity:"warning",children:"Selected Alertmanager no longer exists or you may not have permission to access it."})),g=e=>{let{availableAlertManagers:t}=e;const[a,n]=(0,c.k)(t),s=t.length>0;return(0,d.jsx)("div",{children:s?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(o.P,{onChange:n,dataSources:t}),r||(r=(0,d.jsx)(m,{}))]}):l||(l=(0,d.jsx)(u,{}))})}},83221:(e,t,a)=>{a.d(t,{A:()=>i});a(68404);var n=a(21888),s=a(8006),r=a(45916);const l=["tooltip","icon","to","target","onClick","className","tooltipPlacement"];const i=e=>{let{tooltip:t,icon:a,to:i,target:c,onClick:o,className:d,tooltipPlacement:u="top"}=e,m=function(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,l);const g="string"==typeof t?t:void 0;return(0,r.jsx)(n.u,{content:t,placement:u,children:i?(0,r.jsx)(s.Qj,Object.assign({variant:"secondary",fill:"text",icon:a,href:i,size:"sm",target:c},m,{"aria-label":g})):(0,r.jsx)(s.zx,Object.assign({className:d,variant:"secondary",fill:"text",size:"sm",icon:a,type:"button",onClick:o},m,{"aria-label":g}))})}},40711:(e,t,a)=>{a.d(t,{G:()=>i});a(68404);var n=a(8157),s=a(54743),r=a(45916);const l={[n.Z9.Active]:"bad",[n.Z9.Unprocessed]:"neutral",[n.Z9.Suppressed]:"info"},i=e=>{let{state:t}=e;return(0,r.jsx)(s.i,{state:l[t],children:t})}},74562:(e,t,a)=>{a.d(t,{g:()=>c});var n=a(52423),s=(a(68404),a(16755)),r=a(76961),l=a(72710),i=a(45916);const c=e=>{let{matchers:t}=e;const a=(0,s.wW)(o);return(0,i.jsx)("div",{children:(0,i.jsx)(r.P,{className:a.tags,tags:t.map((e=>`${e.name}${(0,l.zy)(e)}${e.value}`))})})},o=()=>({tags:n.css`
    justify-content: flex-start;
  `})},69066:(e,t,a)=>{a.d(t,{k:()=>c});var n=a(68404),s=a(19512),r=a(78130),l=a(74846),i=a(43271);function c(e){const[t,a]=(0,s.K)(),c=function(e){return(0,n.useCallback)((t=>e.map((e=>e.name)).includes(t)),[e])}(e),o=(0,n.useCallback)((e=>{c(e)&&(e===i.GC?(r.Z.delete(l.de),a({[l.c4]:null})):(r.Z.set(l.de,e),a({[l.c4]:e})))}),[a,c]),d=t[l.c4];if(d&&"string"==typeof d)return c(d)?[d,o]:[void 0,o];const u=r.Z.get(l.de);return u&&"string"==typeof u&&c(u)?(o(u),[u,o]):c(i.GC)?[i.GC,o]:[void 0,o]}},46150:(e,t,a)=>{a.d(t,{k:()=>r});var n=a(68404),s=a(43271);function r(e){return(0,n.useMemo)((()=>(0,s.LE)(e)),[e])}},36521:(e,t,a)=>{a.d(t,{Kd:()=>o,Zo:()=>c});var n=a(82897),s=a(68404),r=a(43271),l=a(80458),i=a(76938);function c(e){const t=(0,i._)((e=>e.promRules)),a=(0,i._)((e=>e.rulerRules)),n=(0,s.useRef)({}),c=(0,s.useMemo)((()=>{if(e){const t=(0,r.o_)(e);if(!t)throw new Error(`Unknown rules source: ${e}`);return[t]}return(0,r.h_)()}),[e]);return(0,s.useMemo)((()=>c.map((e=>{var s,i;const c=(0,r.jq)(e)?e.name:e,o=null===(s=t[c])||void 0===s?void 0:s.result,m=null===(i=a[c])||void 0===i?void 0:i.result,g=n.current[c];if(g&&g.promRules===o&&g.rulerRules===m)return g.result;const h={};Object.entries(m||{}).forEach((t=>{let[a,n]=t;const s={rulesSource:e,name:a,groups:[]};h[a]=s,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.groups=t.map((t=>{const a={name:t.name,interval:t.interval,source_tenants:t.source_tenants,rules:[]};return a.rules=t.rules.map((t=>d(t,e,a))),a}))}(s,n)})),null==o||o.forEach((t=>{let{name:a,groups:n}=t;!function(e,t){const a=new Map;e.groups.forEach((e=>a.set(e.name,e))),t.forEach((t=>{var n;let s=a.get(t.name);s||(s={name:t.name,rules:[]},e.groups.push(s),a.set(t.name,s));const i=new Map;s.rules.forEach((e=>{const t=i.get(e.name);t?t.push(e):i.set(e.name,[e])})),(null!==(n=t.rules)&&void 0!==n?n:[]).forEach((t=>{const a=function(e,t,a){const n=t.get(e.name);if(!n)return;if((0,r.HY)(a))return n[0];const s=n.find((t=>!t.promRule&&u(t,e,!0)));if(s)return s;const l=n.find((t=>!t.promRule&&u(t,e,!1)));if(l)return l;return}(t,i,e.rulesSource);a?a.promRule=t:s.rules.push(function(e,t,a){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,l.x_)(e)&&e.annotations||{},promRule:e,namespace:t,group:a}}(t,e,s))}))}))}(h[a]=h[a]||{rulesSource:e,name:a,groups:[]},n)}));const x=Object.values(h);return n.current[c]={promRules:o,rulerRules:m,result:x},x})).flat()),[t,a,c])}function o(e){return e.map((e=>{const t=Object.assign({},e,{groups:[]});var a;return t.groups.push({name:"default",rules:(a=e.groups.flatMap((e=>e.rules)),a.sort(((e,t)=>e.name.localeCompare(t.name))))}),t}))}function d(e,t,a){return(0,l.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:a}:(0,l.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:t,group:a}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:a}}function u(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.name===t.name&&(0,n.isEqual)([a?m(e.query):"",e.labels,e.annotations],[a?m(t.query):"",t.labels||{},(0,l.x_)(t)&&t.annotations||{}])}function m(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,-1)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}},34426:(e,t,a)=>{a.d(t,{j:()=>l});var n=a(68404),s=a(70356),r=a(80795);function l(){const{search:e}=(0,s.TH)();return[(0,n.useMemo)((()=>new URLSearchParams(e)),[e]),(0,n.useCallback)(((e,t)=>{r.E1.partial(e,t)}),[])]}},18033:(e,t,a)=>{a.d(t,{D:()=>s});var n=a(52423);const s=e=>({table:n.css`
    width: 100%;
    border-radius: ${e.shape.borderRadius()};
    border: solid 1px ${e.colors.border.weak};
    background-color: ${e.colors.background.secondary};

    th {
      padding: ${e.spacing(1)};
    }

    td {
      padding: 0 ${e.spacing(1)};
    }

    tr {
      height: 38px;
    }
  `,evenRow:n.css`
    background-color: ${e.colors.background.primary};
  `,colExpand:n.css`
    width: 36px;
  `,actionsCell:n.css`
    text-align: right;
    width: 1%;
    white-space: nowrap;

    & > * + * {
      margin-left: ${e.spacing(.5)};
    }
  `})}}]);
//# sourceMappingURL=AlertSilences.222a8b9b18664bb38ad3.js.map