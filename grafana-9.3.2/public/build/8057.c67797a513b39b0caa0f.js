"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8057],{47628:(e,t,n)=>{n.d(t,{C0:()=>c,Uv:()=>o,Xq:()=>i});n(68404);var r,s=n(2843),a=n(64313),l=n(45916);let o;!function(e){e.ContactPoint="contact point",e.Template="template",e.MuteTiming="mute timing",e.AlertRule="alert rule",e.RootNotificationPolicy="root notification policy"}(o||(o={}));const i=e=>{let{resource:t}=e;return(0,l.jsxs)(s.b,{title:`This ${t} cannot be edited through the UI`,severity:"info",children:["This ",t," has been provisioned, that means it was created by config. Please contact your server admin to update this ",t,"."]})},c=()=>r||(r=(0,l.jsx)(a.C,{text:"Provisioned",color:"purple"}))},37972:(e,t,n)=>{n.d(t,{F:()=>j});var r,s,a,l=n(52423),o=n(82897),i=n(68404),c=n(68522),u=n(93250),d=n(16755),p=n(99500),h=n(83744),m=n(21888),g=n(4645),x=n(40833),f=n(45916);const j=e=>{let{className:t,onFilterChange:n,defaultQueryString:l}=e;const j=(0,d.wW)(v),b=(0,i.useMemo)((()=>(0,o.debounce)((e=>{(0,u.PN)(x.z7.filterByLabel);const t=e.target;n(t.value)}),600)),[n]);(0,i.useEffect)((()=>b.cancel()),[b]);const y=r||(r=(0,f.jsx)(p.J,{name:"search"}));return(0,f.jsxs)("div",{className:t,children:[(0,f.jsx)(h._,{children:(0,f.jsxs)(c.Stack,{gap:.5,children:[s||(s=(0,f.jsx)("span",{children:"Search by label"})),(0,f.jsx)(m.u,{content:a||(a=(0,f.jsxs)("div",{children:["Filter alerts using label querying, ex:",(0,f.jsx)("pre",{children:'{severity="critical", instance=~"cluster-us-.+"}'})]})),children:(0,f.jsx)(p.J,{className:j.icon,name:"info-circle",size:"sm"})})]})}),(0,f.jsx)(g.I,{placeholder:"Search",defaultValue:l,onChange:b,"data-testid":"search-query-input",prefix:y,className:j.inputWidth})]})},v=e=>({icon:l.css`
    margin-right: ${e.spacing(.5)};
  `,inputWidth:l.css`
    width: 340px;
    flex-grow: 0;
  `})},57306:(e,t,n)=>{n.d(t,{f:()=>H});var r=n(52423),s=n(68404),a=n(76093),l=n(16755),o=n(8006),i=n(54761),c=n(59196),u=n(64850),d=n(78941),p=n(82897),h=n(6432),m=n(68522),g=n(38953),x=n(2843),f=n(65678),j=n(83744),v=n(21888),b=n(99500),y=n(4645),w=n(64834),S=n(76938);var C,R,N,_=n(68143),q=n(39440),I=n(18304),$=n(45916);const k=e=>{let{alertId:t}=e;const[n,r]=(0,s.useState)(""),a=(0,s.useCallback)((e=>{r(e.currentTarget.value)}),[]),{loading:o,error:i,result:c=[]}=function(e){const t=(0,u.I0)(),n=(0,S._)((e=>e.managedAlertStateHistory));return(0,s.useEffect)((()=>{t((0,w.Ms)(e))}),[t,e]),n}(t),d=(0,l.wW)(W);if(o&&!i)return C||(C=(0,$.jsx)(g.u,{text:"Loading history..."}));if(i&&!o)return(0,$.jsx)(x.b,{title:"Failed to fetch alert state history",children:i.message});const h=[{id:"state",label:"State",size:"max-content",renderCell:F},{id:"value",label:"",size:"auto",renderCell:M},{id:"timestamp",label:"Time",size:"max-content",renderCell:z}],_=Object.entries(function(e){const t=e.map((e=>{var t,n;const r=/{.*?}/g,s=null!==(t=null===(n=e.text.match(r))||void 0===n?void 0:n.at(-1))&&void 0!==t?t:"";return{id:String(e.id),state:e.newState,text:e.text.replace(s,""),data:e.data,timestamp:e.updated,stringifiedLabels:s}}));return(0,p.groupBy)(t,(e=>e.stringifiedLabels))}(c)).sort().filter((e=>{let[t]=e;return function(e,t){if(""===t)return!0;if(!t.startsWith("/")||!t.endsWith("/"))return e.includes(t);try{return new RegExp(t.slice(1,-1)).test(e)}catch(e){return!1}}(t,n)})).map((e=>{let[t,n]=e;const r=n.map((e=>({id:e.id,data:e})));return(0,$.jsxs)("div",{children:[(0,$.jsx)("header",{className:d.tableGroupKey,children:(0,$.jsx)("code",{children:t})}),(0,$.jsx)(q.t,{cols:h,items:r})]},t)}));return(0,$.jsxs)("div",{children:[(0,$.jsx)("nav",{children:(0,$.jsx)(f.g,{label:R||(R=(0,$.jsx)(j._,{children:(0,$.jsxs)(m.Stack,{gap:.5,children:[(0,$.jsx)("span",{children:"Filter group"}),(0,$.jsx)(v.u,{content:(0,$.jsxs)("div",{children:["Filter each state history group either by exact match or a regular expression, ex:"," ",(0,$.jsx)("code",{children:"region=eu-west-1"})," or ",(0,$.jsx)("code",{children:"/region=us-.+/"})]}),children:(0,$.jsx)(b.J,{name:"info-circle",size:"sm"})})]})})),children:(0,$.jsx)(y.I,{prefix:N||(N=(0,$.jsx)(b.J,{name:"search"})),onChange:a,placeholder:"Search"})})}),_]})};function M(e){var t,n;const r=null!==(t=null===(n=e.data.data)||void 0===n?void 0:n.evalMatches)&&void 0!==t?t:[];return(0,$.jsxs)($.Fragment,{children:[e.data.text,(0,$.jsx)(E,{children:r.map((e=>(0,$.jsx)(_.i,{labelKey:e.metric,value:String(e.value)},e.metric)))})]})}function F(e){return(0,$.jsx)(I.l,{state:e.data.state})}function z(e){return(0,$.jsx)("div",{className:P,children:e.data.timestamp&&(0,$.jsx)("span",{children:(0,h.dq)(e.data.timestamp)})})}const E=e=>{let{children:t}=e;const{wrapper:n}=(0,l.wW)(W);return(0,$.jsx)("div",{className:n,children:t})},P=r.css`
  display: flex;
  align-items: flex-end;
  flex-direction: column;
`,W=e=>({wrapper:r.css`
    & > * {
      margin-right: ${e.spacing(1)};
    }
  `,tableGroupKey:r.css`
    margin-top: ${e.spacing(2)};
    margin-bottom: ${e.spacing(2)};
  `});var L,D=n(72710),U=n(74846),O=n(43271),V=n(23691),T=n(80458);const H=e=>{var t,n;let{rule:r,rulesSource:p}=e;const h=(0,l.wW)(Q),{group:m}=r,g=(0,T.Pc)(r.rulerRule)&&null!==(t=r.rulerRule.grafana_alert.id)&&void 0!==t?t:"",{StateHistoryModal:x,showStateHistoryModal:f}=function(e){var t;const[n,r]=(0,s.useState)(!1);return{StateHistoryModal:(0,s.useMemo)((()=>(0,$.jsx)(d.u,{isOpen:n,onDismiss:()=>r(!1),closeOnBackdropClick:!0,closeOnEscape:!0,title:"State history",children:t||(t=(0,$.jsx)(k,{alertId:e}))})),[e,n]),showStateHistoryModal:()=>r(!0),hideStateHistoryModal:()=>r(!1)}}(g),j=(0,O.HY)(p)?p:null===(n=(0,D.Xy)(p.jsonData.alertmanagerUid))||void 0===n?void 0:n.name,v=c.Vt.hasPermission(u.bW.DataSourcesExplore),b=[],y=(0,T.Jq)(m);if((0,O.jq)(p)&&v&&!y&&b.push((0,$.jsx)(o.Qj,{className:h.button,size:"xs",variant:"primary",icon:"chart-line",target:"__blank",href:(0,V.mH)(p.name,r.query),children:"See graph"},"explore")),r.annotations[U.q6.runbookURL]&&b.push((0,$.jsx)(o.Qj,{className:h.button,size:"xs",variant:"primary",icon:"book",target:"__blank",href:a.QX.sanitizeUrl(r.annotations[U.q6.runbookURL]),children:"View runbook"},"runbook")),r.annotations[U.q6.dashboardUID]){const e=r.annotations[U.q6.dashboardUID];if(e){b.push((0,$.jsx)(o.Qj,{className:h.button,size:"xs",variant:"primary",icon:"apps",target:"__blank",href:`d/${encodeURIComponent(e)}`,children:"Go to dashboard"},"dashboard"));const t=r.annotations[U.q6.panelID];t&&b.push((0,$.jsx)(o.Qj,{className:h.button,size:"xs",variant:"primary",icon:"apps",target:"__blank",href:`d/${encodeURIComponent(e)}?viewPanel=${encodeURIComponent(t)}`,children:"Go to panel"},"panel"))}}return j&&c.Vt.hasAccess(u.bW.AlertingInstanceCreate,c.Vt.isEditor)&&b.push((0,$.jsx)(o.Qj,{className:h.button,size:"xs",icon:"bell-slash",target:"__blank",href:(0,V.Vv)(j,r),children:"Silence"},"silence")),g&&b.push((0,$.jsxs)(s.Fragment,{children:[(0,$.jsx)(o.zx,{className:h.button,size:"xs",icon:"history",onClick:()=>f(),children:"Show state history"}),x]},"history")),b.length?(0,$.jsx)("div",{className:h.wrapper,children:(0,$.jsx)(i.Lh,{width:"auto",children:b.length?b:L||(L=(0,$.jsx)("div",{}))})}):null},Q=e=>({wrapper:r.css`
    padding: ${e.spacing(2)} 0;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    flex-wrap: wrap;
    border-bottom: solid 1px ${e.colors.border.medium};
  `,button:r.css`
    height: 24px;
    margin-top: ${e.spacing(1)};
    font-size: ${e.typography.size.sm};
  `})},81887:(e,t,n)=>{n.d(t,{J:()=>o});var r=n(52423),s=(n(68404),n(16755)),a=n(34087),l=n(45916);function o(e){const{annotations:t}=e,n=(0,s.wW)(i);return 0===t.length?null:(0,l.jsx)("div",{className:n.annotations,children:t.map((e=>{let[t,n]=e;return(0,l.jsx)(a.a,{annotationKey:t,value:n},t)}))})}const i=()=>({annotations:r.css`
    margin-top: 46px;
  `})},93991:(e,t,n)=>{n.d(t,{C:()=>p});var r=n(52423),s=n(68404),a=n(8910),l=n(16755),o=n(91018),i=n(43271),c=n(80458),u=n(95018),d=n(45916);function p(e){const{rulesSource:t,rule:n}=e,r=(0,l.wW)(h),p=(0,s.useMemo)((()=>{if((0,i.jq)(t))return[{name:t.name,icon:t.meta.info.logos.small}];if((0,c.Pc)(n.rulerRule)){const{data:e}=n.rulerRule.grafana_alert,t=e.reduce(((e,t)=>{const n=(0,a.F)().getInstanceSettings(t.datasourceUid);return n&&n.uid!==o.Yq?(e[n.name]={name:n.name,icon:n.meta.info.logos.small},e):e}),{});return Object.values(t)}return[]}),[n,t]);return 0===p.length?null:(0,d.jsx)(u.C,{label:"Data source",children:p.map(((e,t)=>{let{name:n,icon:s}=e;return(0,d.jsxs)("div",{children:[s&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("img",{alt:`${n} datasource logo`,className:r.dataSourceIcon,src:s})," "]}),n]},n)}))})}function h(e){const t=e.spacing(2);return{dataSourceIcon:r.css`
      width: ${t};
      height: ${t};
    `}}},47286:(e,t,n)=>{n.d(t,{C:()=>v});var r=n(52423),s=n(68404),a=n(43271),l=n(95018),o=n(57706),i=n(57597),c=n(55128),u=n(23766),d=n(16755),p=n(70039),h=n(38261),m=n(12547),g=n(45916);const x=e=>{let{language:t,expr:n}=e;const r=(0,s.useMemo)((()=>[(0,c.Z)({onlyIn:e=>"code_block"===e.type,getSyntax:()=>t},Object.assign({},o.languages,{[t]:"logql"===t?p.ZP:h.ZP}))]),[t]),a=(0,s.useMemo)((()=>(0,u.l1)(n)),[n]);return(0,g.jsx)(i.ML,{"data-testid":"expression-editor",plugins:r,value:a})},f=e=>{let{expression:t,rulesSource:n}=e;const s=(0,d.wW)(j);return(0,g.jsx)(m.t,{className:(0,r.cx)(s.well,"slate-query-field"),children:(0,a.jq)(n)?(0,g.jsx)(x,{expr:t,language:n.type===a.ye.Loki?"logql":"promql"}):t})},j=e=>({well:r.css`
    font-family: ${e.typography.fontFamilyMonospace};
  `});function v(e){const{annotations:t,rulesSource:n,rule:s}=e,o=b();return(0,a.jq)(n)?(0,g.jsx)(l.C,{label:"Expression",horizontal:!0,className:(0,r.cx)({[o.exprRow]:!!t.length}),children:(0,g.jsx)(f,{expression:s.query,rulesSource:n})}):null}const b=()=>({exprRow:r.css`
    margin-bottom: 46px;
  `})},39778:(e,t,n)=>{n.d(t,{M:()=>R});var r,s=n(52423),a=n(82897),l=n(68404),o=n(16755),i=n(8006),c=n(37972),u=n(51028),d=n(83744),p=n(37625),h=n(22587),m=n(45916);const g=e=>{let{className:t,onStateFilterChange:n,stateFilter:s,filterType:l,itemPerStateStats:i}=e;const c=(0,o.wW)(x),g=e=>function(){return i&&i[e]?(0,m.jsx)(u.V,{name:i[e].toFixed(0),colorIndex:9,className:c.tag}):null},f=Object.values(h.bj).map((e=>({label:e,value:e,component:g(e)}))),j=[h.x_.Firing,h.x_.Pending].map((e=>({label:(0,a.capitalize)(e),value:e,component:g(e)}))),v="grafana"===l?f:j;return(0,m.jsxs)("div",{className:t,"data-testid":"alert-instance-state-filter",children:[r||(r=(0,m.jsx)(d._,{children:"State"})),(0,m.jsx)(p.S,{options:v,value:s,onChange:n,onClick:e=>{e===s&&n(void 0)}})]})};function x(e){return{tag:s.css`
      font-size: 11px;
      font-weight: normal;
      padding: ${e.spacing(.25,.5)};
      vertical-align: middle;
      margin-left: ${e.spacing(.5)};
    `}}var f=n(72710),j=n(23691),v=n(23854),b=n(43271),y=n(80458),w=n(95018),S=n(67610);function C(e){const t=(0,o.wW)(N),{ruleViewPageLink:n,stats:r}=e;return(0,m.jsxs)("div",{className:t.footerRow,children:[(0,m.jsxs)("div",{children:["Showing ",r.visibleItemsCount," out of ",r.totalItemsCount," instances"]}),n&&(0,m.jsxs)(i.Qj,{href:n,size:"sm",variant:"secondary",children:["Show all ",r.totalItemsCount," alert instances"]})]})}function R(e){const{rule:{promRule:t,namespace:n},itemsDisplayLimit:r=Number.POSITIVE_INFINITY,pagination:i}=e,[u,d]=(0,l.useState)(),[p,x]=(0,l.useState)(),[R]=(0,l.useState)(Math.floor(100*Math.random())),_=`queryString-${R}`,q=(0,o.wW)(N),I=(0,b.HY)(n.rulesSource)?b.GC:"prometheus",$=(0,l.useMemo)((()=>{var e;return(0,y.x_)(t)&&null!==(e=t.alerts)&&void 0!==e&&e.length?function(e,t,n){let r=[...n];if(e){const t=(0,f.Zh)(e||"");r=r.filter((e=>{let{labels:n}=e;return(0,f.eD)(n,t)}))}t&&(r=r.filter((e=>(0,h.ED)(e.state)===t)));return r}(u,p,(0,j.Zl)(v.As.Importance,t.alerts)):[]}),[t,p,u]);if(!(0,y.x_)(t))return null;const k=$.slice(0,r),M=(0,a.countBy)(t.alerts,(e=>(0,h.ED)(e.state))),F=$.length-k.length,z={totalItemsCount:$.length,visibleItemsCount:k.length},E=(0,j.V2)(n.rulesSource,e.rule,location.pathname+location.search),P=F?(0,m.jsx)(C,{stats:z,ruleViewPageLink:E}):void 0;return(0,m.jsxs)(w.C,{label:"Matching instances",horizontal:!0,children:[(0,m.jsx)("div",{className:(0,s.cx)(q.flexRow,q.spaceBetween),children:(0,m.jsxs)("div",{className:q.flexRow,children:[(0,m.jsx)(c.F,{className:q.rowChild,defaultQueryString:u,onFilterChange:e=>d(e)},_),(0,m.jsx)(g,{className:q.rowChild,filterType:I,stateFilter:p,onStateFilterChange:x,itemPerStateStats:M})]})}),(0,m.jsx)(S.o,{instances:k,pagination:i,footerRow:P})]})}const N=e=>({flexRow:s.css`
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      width: 100%;
      flex-wrap: wrap;
      margin-bottom: ${e.spacing(1)};
    `,spaceBetween:s.css`
      justify-content: space-between;
    `,rowChild:s.css`
      margin-right: ${e.spacing(1)};
    `,footerRow:s.css`
      display: flex;
      flex-direction: column;
      gap: ${e.spacing(1)};
      justify-content: space-between;
      align-items: center;
      width: 100%;
    `})},84438:(e,t,n)=>{n.d(t,{V:()=>u});var r,s,a=n(52423),l=(n(68404),n(16755)),o=n(21888),i=n(99500),c=n(45916);const u=e=>{let{rule:t}=e;const n=(0,l.wW)(d);return"err"===t.health||"error"===t.health?(0,c.jsx)(o.u,{theme:"error",content:t.lastError||"No error message provided.",children:(0,c.jsxs)("div",{className:n.warn,children:[r||(r=(0,c.jsx)(i.J,{name:"exclamation-triangle"})),s||(s=(0,c.jsx)("span",{children:"error"}))]})}):(0,c.jsx)(c.Fragment,{children:t.health})},d=e=>({warn:a.css`
    display: inline-flex;
    flex-direction: row;
    align-items: center;
    gap: ${e.spacing(1)};

    color: ${e.colors.warning.text};
  `})},31244:(e,t,n)=>{n.d(t,{p:()=>g});var r,s,a=n(52423),l=n(68404),o=n(13960),i=n(16755),c=n(54761),u=n(81691),d=n(22587),p=n(80458),h=n(18304),m=n(45916);const g=e=>{let{rule:t,isDeleting:n,isCreating:a}=e;const g=(0,i.wW)(x),{promRule:f}=t,j=(0,l.useMemo)((()=>{var e;if(f&&(0,p.x_)(f)&&null!==(e=f.alerts)&&void 0!==e&&e.length&&f.state!==d.x_.Inactive){const e=(0,p.ub)(f);if(e)return(0,m.jsxs)("span",{title:String(e),className:g.for,children:["for"," ",(0,o.vT)({start:e,end:new Date},!1)]})}return null}),[f,g]);return n?r||(r=(0,m.jsxs)(c.Lh,{align:"flex-start",children:[(0,m.jsx)(u.$,{}),"deleting"]})):a?s||(s=(0,m.jsxs)(c.Lh,{align:"flex-start",children:[" ",(0,m.jsx)(u.$,{}),"creating"]})):f&&(0,p.x_)(f)?(0,m.jsxs)(c.Lh,{align:"flex-start",children:[(0,m.jsx)(h.l,{state:f.state}),j]}):f&&(0,p.OP)(f)?(0,m.jsx)(m.Fragment,{children:"Recording rule"}):(0,m.jsx)(m.Fragment,{children:"n/a"})},x=e=>({for:a.css`
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
    white-space: nowrap;
    padding-top: 2px;
  `})},36521:(e,t,n)=>{n.d(t,{Kd:()=>c,Zo:()=>i});var r=n(82897),s=n(68404),a=n(43271),l=n(80458),o=n(76938);function i(e){const t=(0,o._)((e=>e.promRules)),n=(0,o._)((e=>e.rulerRules)),r=(0,s.useRef)({}),i=(0,s.useMemo)((()=>{if(e){const t=(0,a.o_)(e);if(!t)throw new Error(`Unknown rules source: ${e}`);return[t]}return(0,a.h_)()}),[e]);return(0,s.useMemo)((()=>i.map((e=>{var s,o;const i=(0,a.jq)(e)?e.name:e,c=null===(s=t[i])||void 0===s?void 0:s.result,p=null===(o=n[i])||void 0===o?void 0:o.result,h=r.current[i];if(h&&h.promRules===c&&h.rulerRules===p)return h.result;const m={};Object.entries(p||{}).forEach((t=>{let[n,r]=t;const s={rulesSource:e,name:n,groups:[]};m[n]=s,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.groups=t.map((t=>{const n={name:t.name,interval:t.interval,source_tenants:t.source_tenants,rules:[]};return n.rules=t.rules.map((t=>u(t,e,n))),n}))}(s,r)})),null==c||c.forEach((t=>{let{name:n,groups:r}=t;!function(e,t){const n=new Map;e.groups.forEach((e=>n.set(e.name,e))),t.forEach((t=>{var r;let s=n.get(t.name);s||(s={name:t.name,rules:[]},e.groups.push(s),n.set(t.name,s));const o=new Map;s.rules.forEach((e=>{const t=o.get(e.name);t?t.push(e):o.set(e.name,[e])})),(null!==(r=t.rules)&&void 0!==r?r:[]).forEach((t=>{const n=function(e,t,n){const r=t.get(e.name);if(!r)return;if((0,a.HY)(n))return r[0];const s=r.find((t=>!t.promRule&&d(t,e,!0)));if(s)return s;const l=r.find((t=>!t.promRule&&d(t,e,!1)));if(l)return l;return}(t,o,e.rulesSource);n?n.promRule=t:s.rules.push(function(e,t,n){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,l.x_)(e)&&e.annotations||{},promRule:e,namespace:t,group:n}}(t,e,s))}))}))}(m[n]=m[n]||{rulesSource:e,name:n,groups:[]},r)}));const g=Object.values(m);return r.current[i]={promRules:c,rulerRules:p,result:g},g})).flat()),[t,n,i])}function c(e){return e.map((e=>{const t=Object.assign({},e,{groups:[]});var n;return t.groups.push({name:"default",rules:(n=e.groups.flatMap((e=>e.rules)),n.sort(((e,t)=>e.name.localeCompare(t.name))))}),t}))}function u(e,t,n){return(0,l.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:n}:(0,l.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:t,group:n}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:n}}function d(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.name===t.name&&(0,r.isEqual)([n?p(e.query):"",e.labels,e.annotations],[n?p(t.query):"",t.labels||{},(0,l.x_)(t)&&t.annotations||{}])}function p(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,-1)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}}}]);
//# sourceMappingURL=8057.c67797a513b39b0caa0f.js.map